<link rel="import" href="mypoly-mapitem.html">
<!--<link rel="import" href="./mypoly-drawingmenu.html">-->

<polymer-element name='d3-map' attributes='latitude longitude zoom'>

 <template>
  <style>
  core-header-panel {
        height: 100%;
        overflow: auto;
        width: 100%;
        float: left;
        /*-webkit-overflow-scrolling: touch;*/ 
      }
      core-toolbar {
        position: relative;
        background: #03a9f4;
        color: white;
      }
      #tabs {
        width: 100%;
        margin: 0;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      .container {
        width: 100%;
        margin: 50px auto;
      }
      @media (min-width: 481px) {
        #tabs {
          width: 200px;
        }
        .container {
          width: 100%;
        }
      }
      
    :host {
      display: block;
      width: 100%;
    }
    
   
    .entity {
       fill: none;
       stroke: red;
   }
    
  </style>

       
    <div id="map" width = {{width}} height = {{height}}></div>

 </template>
 <script>
 
 (function(){
 Polymer({
    width: 400,
    height: 400,
    created: function(){
         this.features = [];
    },
    attached: function(){
        var self = this;
        this.width = this.clientWidth;
        this.height = this.clientHeight; //TODO, get the proper container height
        
        this.map = new d3.mappu.Map(this.$.map,{
            center: [this.longitude,this.latitude],
            zoom: this.zoom
            }
        );

        
        this.map.size = [this.height,this.width];
        this.map.redraw();
        
        window.addEventListener("resize",function(){
            self.width = self.clientWidth;
            self.height = self.clientHeight;
            self.map.size = [self.height,self.width];
            self.map.redraw();
        });
    },
    redraw: function(){
        this.map.redraw();
    },
    zoom: function(val){
        this.map.zoom = val;
    },
    zoomTo: function(extent){
        console.warn('not implemented');
    },
    center: function(position){
    	if (position[0] >= -180 && position[0] <= 180 
    			&& position[1] >= -90 && position[1] <= 90){
    		this.map.center = position;
    	}
    	else {
    		console.warn('Wrong coordinates: ',position);
    	}
    },
    draw: function(d){
        this.map.redraw(d);
    },
    layers: function(){
        return this.map.layers;
    },
    map: function(){
        return this.map;
    }
 });
 })();
 </script>
</polymer-element>
